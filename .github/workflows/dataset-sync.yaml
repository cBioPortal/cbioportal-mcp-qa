name: MCP-QA Dataset Sync
on:
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:
    inputs:
      range:
        description: 'Excel range to export (e.g., A:C, A1:D100, Sheet1!A:E)'
        required: false
        default: 'A:C'
        type: string

jobs:
  sync:
    runs-on: ubuntu-latest
    env:
      DATASET_GOOGLE_SHEET_ID: ${{ secrets.DATASET_GOOGLE_SHEET_ID }}
      RANGE: ${{ github.event.inputs.range || 'A:C' }}
      CSV_FILE_PATH: 'input/MCP-QA-auto-synced.csv'
    steps:
      - uses: actions/checkout@v6

      - name: Download Google Sheet as CSV
        run: |
          curl -L "https://docs.google.com/spreadsheets/d/${DATASET_GOOGLE_SHEET_ID}/export?format=csv&range=${RANGE}" \
            -o ${CSV_FILE_PATH}

      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add ${CSV_FILE_PATH}
          git diff --quiet && git diff --staged --quiet || \
            (git commit -m "Update MCP-QA from Google Sheet" && git push)