# Question 25

**Type:** Genomic Alteration Comparison

**Question:** How does the mutation landscape differ between primary and metastatic samples from the same patients in the MSK-CHORD Study?

**Answer:**

I'll analyze the mutation landscape differences between primary and metastatic samples from the same patients in the MSK-CHORD study. Let me start by exploring the data structure and then compare the mutation patterns.



Calling `clickhouse_run_select_query` with args:
```json
{
  "query": "\n-- First, let's identify patients with both primary and metastatic samples\nSELECT \n    patient_unique_id,\n    COUNT(DISTINCT CASE WHEN attribute_value = 'Primary' THEN sample_unique_id END) as primary_samples,\n    COUNT(DISTINCT CASE WHEN attribute_value = 'Metastasis' THEN sample_unique_id END) as metastatic_samples\nFROM clinical_data_derived\nWHERE cancer_study_identifier = 'msk_chord_2024'\n    AND attribute_name = 'SAMPLE_TYPE'\n    AND attribute_value IN ('Primary', 'Metastasis')\nGROUP BY patient_unique_id\nHAVING primary_samples > 0 AND metastatic_samples > 0\nORDER BY patient_unique_id\nLIMIT 20\n"
}
```



Result from `clickhouse_run_select_query`:
```json
{"rows":[{"patient_unique_id":"msk_chord_2024_P-0000012","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0000825","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0007080","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0007887","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0008077","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0010785","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0010965","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0011043","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0016181","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0016731","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0018588","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0021156","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0025952","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0028809","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0038062","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0039656","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0042066","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0043580","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0046090","primary_samples":1,"metastatic_samples":1},{"patient_unique_id":"msk_chord_2024_P-0047234","primary_samples":1,"metastatic_samples":1}]}
```




Calling `clickhouse_run_select_query` with args:
```json
{
  "query": "\n-- Get total count of patients with both sample types\nSELECT \n    COUNT(DISTINCT patient_unique_id) as patients_with_both_types\nFROM (\n    SELECT \n        patient_unique_id,\n        COUNT(DISTINCT CASE WHEN attribute_value = 'Primary' THEN sample_unique_id END) as primary_samples,\n        COUNT(DISTINCT CASE WHEN attribute_value = 'Metastasis' THEN sample_unique_id END) as metastatic_samples\n    FROM clinical_data_derived\n    WHERE cancer_study_identifier = 'msk_chord_2024'\n        AND attribute_name = 'SAMPLE_TYPE'\n        AND attribute_value IN ('Primary', 'Metastasis')\n    GROUP BY patient_unique_id\n    HAVING primary_samples > 0 AND metastatic_samples > 0\n)\n"
}
```



Result from `clickhouse_run_select_query`:
```json
{"rows":[{"patients_with_both_types":26}]}
```




Calling `clickhouse_run_select_query` with args:
```json
{
  "query": "\n-- Compare mutation counts between primary and metastatic samples for the same patients\nWITH paired_patients AS (\n    SELECT DISTINCT patient_unique_id\n    FROM (\n        SELECT \n            patient_unique_id,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Primary' THEN sample_unique_id END) as primary_samples,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Metastasis' THEN sample_unique_id END) as metastatic_samples\n        FROM clinical_data_derived\n        WHERE cancer_study_identifier = 'msk_chord_2024'\n            AND attribute_name = 'SAMPLE_TYPE'\n            AND attribute_value IN ('Primary', 'Metastasis')\n        GROUP BY patient_unique_id\n        HAVING primary_samples > 0 AND metastatic_samples > 0\n    )\n),\nsample_types AS (\n    SELECT \n        cd.sample_unique_id,\n        cd.patient_unique_id,\n        cd.attribute_value as sample_type\n    FROM clinical_data_derived cd\n    INNER JOIN paired_patients pp ON cd.patient_unique_id = pp.patient_unique_id\n    WHERE cd.cancer_study_identifier = 'msk_chord_2024'\n        AND cd.attribute_name = 'SAMPLE_TYPE'\n        AND cd.attribute_value IN ('Primary', 'Metastasis')\n)\nSELECT \n    st.sample_type,\n    COUNT(DISTINCT st.sample_unique_id) as sample_count,\n    COUNT(DISTINCT g.hugo_gene_symbol) as unique_genes_mutated,\n    COUNT(*) as total_mutations,\n    ROUND(COUNT(*) / COUNT(DISTINCT st.sample_unique_id), 2) as avg_mutations_per_sample\nFROM sample_types st\nLEFT JOIN genomic_event_derived g \n    ON st.sample_unique_id = g.sample_unique_id\n    AND g.cancer_study_identifier = 'msk_chord_2024'\n    AND g.variant_type = 'mutation'\nGROUP BY st.sample_type\nORDER BY st.sample_type\n"
}
```



Result from `clickhouse_run_select_query`:
```json
{"rows":[{"sample_type":"Metastasis","sample_count":26,"unique_genes_mutated":164,"total_mutations":280,"avg_mutations_per_sample":10.77},{"sample_type":"Primary","sample_count":26,"unique_genes_mutated":222,"total_mutations":412,"avg_mutations_per_sample":15.85}]}
```




Calling `clickhouse_run_select_query` with args:
```json
{
  "query": "\n-- Get top mutated genes in primary vs metastatic samples\nWITH paired_patients AS (\n    SELECT DISTINCT patient_unique_id\n    FROM (\n        SELECT \n            patient_unique_id,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Primary' THEN sample_unique_id END) as primary_samples,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Metastasis' THEN sample_unique_id END) as metastatic_samples\n        FROM clinical_data_derived\n        WHERE cancer_study_identifier = 'msk_chord_2024'\n            AND attribute_name = 'SAMPLE_TYPE'\n            AND attribute_value IN ('Primary', 'Metastasis')\n        GROUP BY patient_unique_id\n        HAVING primary_samples > 0 AND metastatic_samples > 0\n    )\n),\nsample_types AS (\n    SELECT \n        cd.sample_unique_id,\n        cd.patient_unique_id,\n        cd.attribute_value as sample_type\n    FROM clinical_data_derived cd\n    INNER JOIN paired_patients pp ON cd.patient_unique_id = pp.patient_unique_id\n    WHERE cd.cancer_study_identifier = 'msk_chord_2024'\n        AND cd.attribute_name = 'SAMPLE_TYPE'\n        AND cd.attribute_value IN ('Primary', 'Metastasis')\n)\nSELECT \n    g.hugo_gene_symbol,\n    COUNT(DISTINCT CASE WHEN st.sample_type = 'Primary' THEN st.sample_unique_id END) as primary_mutated_samples,\n    COUNT(DISTINCT CASE WHEN st.sample_type = 'Metastasis' THEN st.sample_unique_id END) as metastatic_mutated_samples,\n    ROUND(COUNT(DISTINCT CASE WHEN st.sample_type = 'Primary' THEN st.sample_unique_id END) * 100.0 / 26, 1) as primary_freq_pct,\n    ROUND(COUNT(DISTINCT CASE WHEN st.sample_type = 'Metastasis' THEN st.sample_unique_id END) * 100.0 / 26, 1) as metastatic_freq_pct\nFROM sample_types st\nINNER JOIN genomic_event_derived g \n    ON st.sample_unique_id = g.sample_unique_id\n    AND g.cancer_study_identifier = 'msk_chord_2024'\n    AND g.variant_type = 'mutation'\nGROUP BY g.hugo_gene_symbol\nHAVING primary_mutated_samples >= 2 OR metastatic_mutated_samples >= 2\nORDER BY (primary_mutated_samples + metastatic_mutated_samples) DESC\nLIMIT 30\n"
}
```



Result from `clickhouse_run_select_query`:
```json
{"rows":[{"hugo_gene_symbol":"TP53","primary_mutated_samples":13,"metastatic_mutated_samples":15,"primary_freq_pct":50.0,"metastatic_freq_pct":57.7},{"hugo_gene_symbol":"KRAS","primary_mutated_samples":10,"metastatic_mutated_samples":8,"primary_freq_pct":38.5,"metastatic_freq_pct":30.8},{"hugo_gene_symbol":"APC","primary_mutated_samples":7,"metastatic_mutated_samples":5,"primary_freq_pct":26.9,"metastatic_freq_pct":19.2},{"hugo_gene_symbol":"ATR","primary_mutated_samples":3,"metastatic_mutated_samples":5,"primary_freq_pct":11.5,"metastatic_freq_pct":19.2},{"hugo_gene_symbol":"PIK3CA","primary_mutated_samples":3,"metastatic_mutated_samples":4,"primary_freq_pct":11.5,"metastatic_freq_pct":15.4},{"hugo_gene_symbol":"KMT2C","primary_mutated_samples":3,"metastatic_mutated_samples":4,"primary_freq_pct":11.5,"metastatic_freq_pct":15.4},{"hugo_gene_symbol":"ARID1A","primary_mutated_samples":3,"metastatic_mutated_samples":3,"primary_freq_pct":11.5,"metastatic_freq_pct":11.5},{"hugo_gene_symbol":"PTPRS","primary_mutated_samples":4,"metastatic_mutated_samples":2,"primary_freq_pct":15.4,"metastatic_freq_pct":7.7},{"hugo_gene_symbol":"RNF43","primary_mutated_samples":5,"metastatic_mutated_samples":1,"primary_freq_pct":19.2,"metastatic_freq_pct":3.8},{"hugo_gene_symbol":"KMT2D","primary_mutated_samples":3,"metastatic_mutated_samples":3,"primary_freq_pct":11.5,"metastatic_freq_pct":11.5},{"hugo_gene_symbol":"BRAF","primary_mutated_samples":4,"metastatic_mutated_samples":1,"primary_freq_pct":15.4,"metastatic_freq_pct":3.8},{"hugo_gene_symbol":"MAP3K1","primary_mutated_samples":1,"metastatic_mutated_samples":4,"primary_freq_pct":3.8,"metastatic_freq_pct":15.4},{"hugo_gene_symbol":"KMT2B","primary_mutated_samples":3,"metastatic_mutated_samples":2,"primary_freq_pct":11.5,"metastatic_freq_pct":7.7},{"hugo_gene_symbol":"FAT1","primary_mutated_samples":3,"metastatic_mutated_samples":2,"primary_freq_pct":11.5,"metastatic_freq_pct":7.7},{"hugo_gene_symbol":"TET1","primary_mutated_samples":3,"metastatic_mutated_samples":2,"primary_freq_pct":11.5,"metastatic_freq_pct":7.7},{"hugo_gene_symbol":"EGFR","primary_mutated_samples":3,"metastatic_mutated_samples":2,"primary_freq_pct":11.5,"metastatic_freq_pct":7.7},{"hugo_gene_symbol":"ATRX","primary_mutated_samples":2,"metastatic_mutated_samples":3,"primary_freq_pct":7.7,"metastatic_freq_pct":11.5},{"hugo_gene_symbol":"STK11","primary_mutated_samples":1,"metastatic_mutated_samples":4,"primary_freq_pct":3.8,"metastatic_freq_pct":15.4},{"hugo_gene_symbol":"POLE","primary_mutated_samples":4,"metastatic_mutated_samples":1,"primary_freq_pct":15.4,"metastatic_freq_pct":3.8},{"hugo_gene_symbol":"ARID1B","primary_mutated_samples":1,"metastatic_mutated_samples":3,"primary_freq_pct":3.8,"metastatic_freq_pct":11.5},{"hugo_gene_symbol":"NSD1","primary_mutated_samples":2,"metastatic_mutated_samples":2,"primary_freq_pct":7.7,"metastatic_freq_pct":7.7},{"hugo_gene_symbol":"RBM10","primary_mutated_samples":2,"metastatic_mutated_samples":2,"primary_freq_pct":7.7,"metastatic_freq_pct":7.7},{"hugo_gene_symbol":"PDGFRA","primary_mutated_samples":1,"metastatic_mutated_samples":3,"primary_freq_pct":3.8,"metastatic_freq_pct":11.5},{"hugo_gene_symbol":"ZFHX3","primary_mutated_samples":1,"metastatic_mutated_samples":3,"primary_freq_pct":3.8,"metastatic_freq_pct":11.5},{"hugo_gene_symbol":"MED12","primary_mutated_samples":4,"metastatic_mutated_samples":0,"primary_freq_pct":15.4,"metastatic_freq_pct":0.0},{"hugo_gene_symbol":"CREBBP","primary_mutated_samples":3,"metastatic_mutated_samples":1,"primary_freq_pct":11.5,"metastatic_freq_pct":3.8},{"hugo_gene_symbol":"EPHA3","primary_mutated_samples":2,"metastatic_mutated_samples":2,"primary_freq_pct":7.7,"metastatic_freq_pct":7.7},{"hugo_gene_symbol":"TERT","primary_mutated_samples":3,"metastatic_mutated_samples":1,"primary_freq_pct":11.5,"metastatic_freq_pct":3.8},{"hugo_gene_symbol":"PTPRD","primary_mutated_samples":2,"metastatic_mutated_samples":2,"primary_freq_pct":7.7,"metastatic_freq_pct":7.7},{"hugo_gene_symbol":"NOTCH3","primary_mutated_samples":2,"metastatic_mutated_samples":2,"primary_freq_pct":7.7,"metastatic_freq_pct":7.7}]}
```




Calling `clickhouse_run_select_query` with args:
```json
{
  "query": "\n-- Analyze genes that are enriched in one sample type vs the other\nWITH paired_patients AS (\n    SELECT DISTINCT patient_unique_id\n    FROM (\n        SELECT \n            patient_unique_id,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Primary' THEN sample_unique_id END) as primary_samples,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Metastasis' THEN sample_unique_id END) as metastatic_samples\n        FROM clinical_data_derived\n        WHERE cancer_study_identifier = 'msk_chord_2024'\n            AND attribute_name = 'SAMPLE_TYPE'\n            AND attribute_value IN ('Primary', 'Metastasis')\n        GROUP BY patient_unique_id\n        HAVING primary_samples > 0 AND metastatic_samples > 0\n    )\n),\nsample_types AS (\n    SELECT \n        cd.sample_unique_id,\n        cd.patient_unique_id,\n        cd.attribute_value as sample_type\n    FROM clinical_data_derived cd\n    INNER JOIN paired_patients pp ON cd.patient_unique_id = pp.patient_unique_id\n    WHERE cd.cancer_study_identifier = 'msk_chord_2024'\n        AND cd.attribute_name = 'SAMPLE_TYPE'\n        AND cd.attribute_value IN ('Primary', 'Metastasis')\n),\ngene_stats AS (\n    SELECT \n        g.hugo_gene_symbol,\n        COUNT(DISTINCT CASE WHEN st.sample_type = 'Primary' THEN st.sample_unique_id END) as primary_mutated,\n        COUNT(DISTINCT CASE WHEN st.sample_type = 'Metastasis' THEN st.sample_unique_id END) as metastatic_mutated,\n        ROUND(COUNT(DISTINCT CASE WHEN st.sample_type = 'Primary' THEN st.sample_unique_id END) * 100.0 / 26, 1) as primary_freq,\n        ROUND(COUNT(DISTINCT CASE WHEN st.sample_type = 'Metastasis' THEN st.sample_unique_id END) * 100.0 / 26, 1) as metastatic_freq\n    FROM sample_types st\n    INNER JOIN genomic_event_derived g \n        ON st.sample_unique_id = g.sample_unique_id\n        AND g.cancer_study_identifier = 'msk_chord_2024'\n        AND g.variant_type = 'mutation'\n    GROUP BY g.hugo_gene_symbol\n)\nSELECT \n    hugo_gene_symbol,\n    primary_mutated,\n    metastatic_mutated,\n    primary_freq,\n    metastatic_freq,\n    ROUND(metastatic_freq - primary_freq, 1) as enrichment_in_metastatic,\n    CASE \n        WHEN metastatic_freq > primary_freq THEN 'Metastasis-enriched'\n        WHEN primary_freq > metastatic_freq THEN 'Primary-enriched'\n        ELSE 'Equal'\n    END as enrichment_pattern\nFROM gene_stats\nWHERE primary_mutated + metastatic_mutated >= 4\nORDER BY ABS(metastatic_freq - primary_freq) DESC\nLIMIT 25\n"
}
```



Result from `clickhouse_run_select_query`:
```json
{"rows":[{"hugo_gene_symbol":"MED12","primary_mutated":4,"metastatic_mutated":0,"primary_freq":15.4,"metastatic_freq":0.0,"enrichment_in_metastatic":-15.4,"enrichment_pattern":"Primary-enriched"},{"hugo_gene_symbol":"RNF43","primary_mutated":5,"metastatic_mutated":1,"primary_freq":19.2,"metastatic_freq":3.8,"enrichment_in_metastatic":-15.4,"enrichment_pattern":"Primary-enriched"},{"hugo_gene_symbol":"POLE","primary_mutated":4,"metastatic_mutated":1,"primary_freq":15.4,"metastatic_freq":3.8,"enrichment_in_metastatic":-11.6,"enrichment_pattern":"Primary-enriched"},{"hugo_gene_symbol":"MAP3K1","primary_mutated":1,"metastatic_mutated":4,"primary_freq":3.8,"metastatic_freq":15.4,"enrichment_in_metastatic":11.6,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"STK11","primary_mutated":1,"metastatic_mutated":4,"primary_freq":3.8,"metastatic_freq":15.4,"enrichment_in_metastatic":11.6,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"BRAF","primary_mutated":4,"metastatic_mutated":1,"primary_freq":15.4,"metastatic_freq":3.8,"enrichment_in_metastatic":-11.6,"enrichment_pattern":"Primary-enriched"},{"hugo_gene_symbol":"TP53","primary_mutated":13,"metastatic_mutated":15,"primary_freq":50.0,"metastatic_freq":57.7,"enrichment_in_metastatic":7.7,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"PTPRS","primary_mutated":4,"metastatic_mutated":2,"primary_freq":15.4,"metastatic_freq":7.7,"enrichment_in_metastatic":-7.7,"enrichment_pattern":"Primary-enriched"},{"hugo_gene_symbol":"CDKN2A","primary_mutated":1,"metastatic_mutated":3,"primary_freq":3.8,"metastatic_freq":11.5,"enrichment_in_metastatic":7.7,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"BRCA2","primary_mutated":3,"metastatic_mutated":1,"primary_freq":11.5,"metastatic_freq":3.8,"enrichment_in_metastatic":-7.7,"enrichment_pattern":"Primary-enriched"},{"hugo_gene_symbol":"TBX3","primary_mutated":1,"metastatic_mutated":3,"primary_freq":3.8,"metastatic_freq":11.5,"enrichment_in_metastatic":7.7,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"NCOR1","primary_mutated":1,"metastatic_mutated":3,"primary_freq":3.8,"metastatic_freq":11.5,"enrichment_in_metastatic":7.7,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"TERT","primary_mutated":3,"metastatic_mutated":1,"primary_freq":11.5,"metastatic_freq":3.8,"enrichment_in_metastatic":-7.7,"enrichment_pattern":"Primary-enriched"},{"hugo_gene_symbol":"PTPRT","primary_mutated":1,"metastatic_mutated":3,"primary_freq":3.8,"metastatic_freq":11.5,"enrichment_in_metastatic":7.7,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"ZFHX3","primary_mutated":1,"metastatic_mutated":3,"primary_freq":3.8,"metastatic_freq":11.5,"enrichment_in_metastatic":7.7,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"KEAP1","primary_mutated":1,"metastatic_mutated":3,"primary_freq":3.8,"metastatic_freq":11.5,"enrichment_in_metastatic":7.7,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"ARID1B","primary_mutated":1,"metastatic_mutated":3,"primary_freq":3.8,"metastatic_freq":11.5,"enrichment_in_metastatic":7.7,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"CREBBP","primary_mutated":3,"metastatic_mutated":1,"primary_freq":11.5,"metastatic_freq":3.8,"enrichment_in_metastatic":-7.7,"enrichment_pattern":"Primary-enriched"},{"hugo_gene_symbol":"PDGFRA","primary_mutated":1,"metastatic_mutated":3,"primary_freq":3.8,"metastatic_freq":11.5,"enrichment_in_metastatic":7.7,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"APC","primary_mutated":7,"metastatic_mutated":5,"primary_freq":26.9,"metastatic_freq":19.2,"enrichment_in_metastatic":-7.7,"enrichment_pattern":"Primary-enriched"},{"hugo_gene_symbol":"ATR","primary_mutated":3,"metastatic_mutated":5,"primary_freq":11.5,"metastatic_freq":19.2,"enrichment_in_metastatic":7.7,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"KRAS","primary_mutated":10,"metastatic_mutated":8,"primary_freq":38.5,"metastatic_freq":30.8,"enrichment_in_metastatic":-7.7,"enrichment_pattern":"Primary-enriched"},{"hugo_gene_symbol":"PIK3CA","primary_mutated":3,"metastatic_mutated":4,"primary_freq":11.5,"metastatic_freq":15.4,"enrichment_in_metastatic":3.9,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"KMT2C","primary_mutated":3,"metastatic_mutated":4,"primary_freq":11.5,"metastatic_freq":15.4,"enrichment_in_metastatic":3.9,"enrichment_pattern":"Metastasis-enriched"},{"hugo_gene_symbol":"EGFR","primary_mutated":3,"metastatic_mutated":2,"primary_freq":11.5,"metastatic_freq":7.7,"enrichment_in_metastatic":-3.8,"enrichment_pattern":"Primary-enriched"}]}
```




Calling `clickhouse_run_select_query` with args:
```json
{
  "query": "\n-- Look at mutation burden (TMB) comparison between primary and metastatic samples\nWITH paired_patients AS (\n    SELECT DISTINCT patient_unique_id\n    FROM (\n        SELECT \n            patient_unique_id,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Primary' THEN sample_unique_id END) as primary_samples,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Metastasis' THEN sample_unique_id END) as metastatic_samples\n        FROM clinical_data_derived\n        WHERE cancer_study_identifier = 'msk_chord_2024'\n            AND attribute_name = 'SAMPLE_TYPE'\n            AND attribute_value IN ('Primary', 'Metastasis')\n        GROUP BY patient_unique_id\n        HAVING primary_samples > 0 AND metastatic_samples > 0\n    )\n),\nsample_types AS (\n    SELECT \n        cd.sample_unique_id,\n        cd.patient_unique_id,\n        cd.attribute_value as sample_type\n    FROM clinical_data_derived cd\n    INNER JOIN paired_patients pp ON cd.patient_unique_id = pp.patient_unique_id\n    WHERE cd.cancer_study_identifier = 'msk_chord_2024'\n        AND cd.attribute_name = 'SAMPLE_TYPE'\n        AND cd.attribute_value IN ('Primary', 'Metastasis')\n),\ntmb_data AS (\n    SELECT \n        st.sample_unique_id,\n        st.sample_type,\n        st.patient_unique_id,\n        CAST(cd.attribute_value AS Float64) as tmb\n    FROM sample_types st\n    LEFT JOIN clinical_data_derived cd \n        ON st.sample_unique_id = cd.sample_unique_id\n        AND cd.cancer_study_identifier = 'msk_chord_2024'\n        AND cd.attribute_name = 'TMB_NONSYNONYMOUS'\n    WHERE cd.attribute_value IS NOT NULL\n)\nSELECT \n    sample_type,\n    COUNT(*) as sample_count,\n    ROUND(AVG(tmb), 2) as avg_tmb,\n    ROUND(median(tmb), 2) as median_tmb,\n    ROUND(MIN(tmb), 2) as min_tmb,\n    ROUND(MAX(tmb), 2) as max_tmb\nFROM tmb_data\nGROUP BY sample_type\nORDER BY sample_type\n"
}
```



Result from `clickhouse_run_select_query`:
```json
{"rows":[{"sample_type":"Metastasis","sample_count":26,"avg_tmb":9.68,"median_tmb":5.96,"min_tmb":0.98,"max_tmb":51.02},{"sample_type":"Primary","sample_count":26,"avg_tmb":13.41,"median_tmb":4.92,"min_tmb":1.11,"max_tmb":103.36}]}
```




Calling `clickhouse_run_select_query` with args:
```json
{
  "query": "\n-- Look at cancer type distribution in these paired samples\nWITH paired_patients AS (\n    SELECT DISTINCT patient_unique_id\n    FROM (\n        SELECT \n            patient_unique_id,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Primary' THEN sample_unique_id END) as primary_samples,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Metastasis' THEN sample_unique_id END) as metastatic_samples\n        FROM clinical_data_derived\n        WHERE cancer_study_identifier = 'msk_chord_2024'\n            AND attribute_name = 'SAMPLE_TYPE'\n            AND attribute_value IN ('Primary', 'Metastasis')\n        GROUP BY patient_unique_id\n        HAVING primary_samples > 0 AND metastatic_samples > 0\n    )\n)\nSELECT \n    cd.attribute_value as cancer_type,\n    COUNT(DISTINCT cd.patient_unique_id) as patient_count\nFROM clinical_data_derived cd\nINNER JOIN paired_patients pp ON cd.patient_unique_id = pp.patient_unique_id\nWHERE cd.cancer_study_identifier = 'msk_chord_2024'\n    AND cd.attribute_name = 'CANCER_TYPE'\nGROUP BY cd.attribute_value\nORDER BY patient_count DESC\n"
}
```



Result from `clickhouse_run_select_query`:
```json
{"rows":[{"cancer_type":"Non-Small Cell Lung Cancer","patient_count":18},{"cancer_type":"Colorectal Cancer","patient_count":12},{"cancer_type":"Pancreatic Cancer","patient_count":9},{"cancer_type":"Prostate Cancer","patient_count":7},{"cancer_type":"Breast Cancer","patient_count":6}]}
```




Calling `clickhouse_run_select_query` with args:
```json
{
  "query": "\n-- Analyze shared vs unique mutations within the same patient\nWITH paired_patients AS (\n    SELECT DISTINCT patient_unique_id\n    FROM (\n        SELECT \n            patient_unique_id,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Primary' THEN sample_unique_id END) as primary_samples,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Metastasis' THEN sample_unique_id END) as metastatic_samples\n        FROM clinical_data_derived\n        WHERE cancer_study_identifier = 'msk_chord_2024'\n            AND attribute_name = 'SAMPLE_TYPE'\n            AND attribute_value IN ('Primary', 'Metastasis')\n        GROUP BY patient_unique_id\n        HAVING primary_samples > 0 AND metastatic_samples > 0\n    )\n),\nsample_types AS (\n    SELECT \n        cd.sample_unique_id,\n        cd.patient_unique_id,\n        cd.attribute_value as sample_type\n    FROM clinical_data_derived cd\n    INNER JOIN paired_patients pp ON cd.patient_unique_id = pp.patient_unique_id\n    WHERE cd.cancer_study_identifier = 'msk_chord_2024'\n        AND cd.attribute_name = 'SAMPLE_TYPE'\n        AND cd.attribute_value IN ('Primary', 'Metastasis')\n),\npatient_mutations AS (\n    SELECT \n        st.patient_unique_id,\n        st.sample_type,\n        g.hugo_gene_symbol\n    FROM sample_types st\n    INNER JOIN genomic_event_derived g \n        ON st.sample_unique_id = g.sample_unique_id\n        AND g.cancer_study_identifier = 'msk_chord_2024'\n        AND g.variant_type = 'mutation'\n)\nSELECT \n    patient_unique_id,\n    COUNT(DISTINCT CASE WHEN sample_type = 'Primary' THEN hugo_gene_symbol END) as primary_mutations,\n    COUNT(DISTINCT CASE WHEN sample_type = 'Metastasis' THEN hugo_gene_symbol END) as metastatic_mutations,\n    COUNT(DISTINCT hugo_gene_symbol) as total_unique_genes,\n    -- Shared mutations are genes present in both sample types for this patient\n    COUNT(DISTINCT CASE WHEN sample_type = 'Primary' THEN hugo_gene_symbol END) + \n    COUNT(DISTINCT CASE WHEN sample_type = 'Metastasis' THEN hugo_gene_symbol END) - \n    COUNT(DISTINCT hugo_gene_symbol) as shared_mutations\nFROM patient_mutations\nGROUP BY patient_unique_id\nORDER BY patient_unique_id\nLIMIT 26\n"
}
```



Result from `clickhouse_run_select_query`:
```json
{"rows":[{"patient_unique_id":"msk_chord_2024_P-0000012","primary_mutations":1,"metastatic_mutations":26,"total_unique_genes":26,"shared_mutations":1},{"patient_unique_id":"msk_chord_2024_P-0000825","primary_mutations":8,"metastatic_mutations":15,"total_unique_genes":22,"shared_mutations":1},{"patient_unique_id":"msk_chord_2024_P-0007080","primary_mutations":1,"metastatic_mutations":6,"total_unique_genes":7,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0007887","primary_mutations":3,"metastatic_mutations":10,"total_unique_genes":12,"shared_mutations":1},{"patient_unique_id":"msk_chord_2024_P-0008077","primary_mutations":6,"metastatic_mutations":1,"total_unique_genes":7,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0010785","primary_mutations":7,"metastatic_mutations":5,"total_unique_genes":11,"shared_mutations":1},{"patient_unique_id":"msk_chord_2024_P-0010965","primary_mutations":3,"metastatic_mutations":15,"total_unique_genes":18,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0011043","primary_mutations":5,"metastatic_mutations":5,"total_unique_genes":9,"shared_mutations":1},{"patient_unique_id":"msk_chord_2024_P-0016181","primary_mutations":64,"metastatic_mutations":16,"total_unique_genes":78,"shared_mutations":2},{"patient_unique_id":"msk_chord_2024_P-0016731","primary_mutations":7,"metastatic_mutations":9,"total_unique_genes":15,"shared_mutations":1},{"patient_unique_id":"msk_chord_2024_P-0018588","primary_mutations":8,"metastatic_mutations":2,"total_unique_genes":10,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0021156","primary_mutations":5,"metastatic_mutations":2,"total_unique_genes":7,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0025952","primary_mutations":97,"metastatic_mutations":47,"total_unique_genes":131,"shared_mutations":13},{"patient_unique_id":"msk_chord_2024_P-0028809","primary_mutations":8,"metastatic_mutations":3,"total_unique_genes":10,"shared_mutations":1},{"patient_unique_id":"msk_chord_2024_P-0038062","primary_mutations":4,"metastatic_mutations":6,"total_unique_genes":10,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0039656","primary_mutations":20,"metastatic_mutations":3,"total_unique_genes":23,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0042066","primary_mutations":5,"metastatic_mutations":9,"total_unique_genes":14,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0043580","primary_mutations":13,"metastatic_mutations":3,"total_unique_genes":15,"shared_mutations":1},{"patient_unique_id":"msk_chord_2024_P-0046090","primary_mutations":5,"metastatic_mutations":5,"total_unique_genes":6,"shared_mutations":4},{"patient_unique_id":"msk_chord_2024_P-0047234","primary_mutations":6,"metastatic_mutations":9,"total_unique_genes":15,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0047288","primary_mutations":2,"metastatic_mutations":3,"total_unique_genes":5,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0070191","primary_mutations":5,"metastatic_mutations":30,"total_unique_genes":34,"shared_mutations":1},{"patient_unique_id":"msk_chord_2024_P-0070882","primary_mutations":6,"metastatic_mutations":7,"total_unique_genes":13,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0074217","primary_mutations":56,"metastatic_mutations":3,"total_unique_genes":59,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0080135","primary_mutations":6,"metastatic_mutations":4,"total_unique_genes":10,"shared_mutations":0},{"patient_unique_id":"msk_chord_2024_P-0086096","primary_mutations":5,"metastatic_mutations":13,"total_unique_genes":18,"shared_mutations":0}]}
```




Calling `clickhouse_run_select_query` with args:
```json
{
  "query": "\n-- Summary statistics on shared vs unique mutations\nWITH paired_patients AS (\n    SELECT DISTINCT patient_unique_id\n    FROM (\n        SELECT \n            patient_unique_id,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Primary' THEN sample_unique_id END) as primary_samples,\n            COUNT(DISTINCT CASE WHEN attribute_value = 'Metastasis' THEN sample_unique_id END) as metastatic_samples\n        FROM clinical_data_derived\n        WHERE cancer_study_identifier = 'msk_chord_2024'\n            AND attribute_name = 'SAMPLE_TYPE'\n            AND attribute_value IN ('Primary', 'Metastasis')\n        GROUP BY patient_unique_id\n        HAVING primary_samples > 0 AND metastatic_samples > 0\n    )\n),\nsample_types AS (\n    SELECT \n        cd.sample_unique_id,\n        cd.patient_unique_id,\n        cd.attribute_value as sample_type\n    FROM clinical_data_derived cd\n    INNER JOIN paired_patients pp ON cd.patient_unique_id = pp.patient_unique_id\n    WHERE cd.cancer_study_identifier = 'msk_chord_2024'\n        AND cd.attribute_name = 'SAMPLE_TYPE'\n        AND cd.attribute_value IN ('Primary', 'Metastasis')\n),\npatient_mutations AS (\n    SELECT \n        st.patient_unique_id,\n        st.sample_type,\n        g.hugo_gene_symbol\n    FROM sample_types st\n    INNER JOIN genomic_event_derived g \n        ON st.sample_unique_id = g.sample_unique_id\n        AND g.cancer_study_identifier = 'msk_chord_2024'\n        AND g.variant_type = 'mutation'\n),\npatient_stats AS (\n    SELECT \n        patient_unique_id,\n        COUNT(DISTINCT CASE WHEN sample_type = 'Primary' THEN hugo_gene_symbol END) as primary_mutations,\n        COUNT(DISTINCT CASE WHEN sample_type = 'Metastasis' THEN hugo_gene_symbol END) as metastatic_mutations,\n        COUNT(DISTINCT hugo_gene_symbol) as total_unique_genes,\n        COUNT(DISTINCT CASE WHEN sample_type = 'Primary' THEN hugo_gene_symbol END) + \n        COUNT(DISTINCT CASE WHEN sample_type = 'Metastasis' THEN hugo_gene_symbol END) - \n        COUNT(DISTINCT hugo_gene_symbol) as shared_mutations\n    FROM patient_mutations\n    GROUP BY patient_unique_id\n)\nSELECT \n    COUNT(*) as total_patients,\n    ROUND(AVG(primary_mutations), 1) as avg_primary_mutations,\n    ROUND(AVG(metastatic_mutations), 1) as avg_metastatic_mutations,\n    ROUND(AVG(shared_mutations), 1) as avg_shared_mutations,\n    ROUND(AVG(shared_mutations) * 100.0 / AVG(primary_mutations), 1) as pct_primary_shared,\n    ROUND(AVG(shared_mutations) * 100.0 / AVG(metastatic_mutations), 1) as pct_metastatic_shared,\n    COUNT(CASE WHEN shared_mutations = 0 THEN 1 END) as patients_with_no_shared_mutations,\n    COUNT(CASE WHEN shared_mutations > 0 THEN 1 END) as patients_with_shared_mutations\nFROM patient_stats\n"
}
```



Result from `clickhouse_run_select_query`:
```json
{"rows":[{"total_patients":26,"avg_primary_mutations":13.7,"avg_metastatic_mutations":9.9,"avg_shared_mutations":1.1,"pct_primary_shared":7.9,"pct_metastatic_shared":10.9,"patients_with_no_shared_mutations":14,"patients_with_shared_mutations":12}]}
```

---

## Model Information
- **model**: us.anthropic.claude-sonnet-4-5-20250929-v1:0
- **temperature**: 0.0
- **max_output_tokens**: 1024
- **thinking_enabled**: False
- **thinking_budget_tokens**: 1024
- **response_time_seconds**: 65.32770395709667
- **agent_type**: mcp-clickhouse

### Usage
- **input_tokens**: 86774
- **output_tokens**: 6467
- **total_tokens**: 93241
- **cache_creation_input_tokens**: 0
- **cache_read_input_tokens**: 0

---

*Generated on 2026-02-05 12:51:10*